.. _通信与调试指导:

=============================
|device| 通信与调试
=============================

-----------------------------
通信
-----------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
仪器工作命令设置
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 开机送出::

        ADDR:0 MODE:1 UART:9600,N,8,1

 提示当前设备通信参数。

 
 进入工作命令模式需要键入如下命令::

        OPEN ID<cr><lf>

 回传::

         Command Mode Open<cr><lf>

 工作命令模式关闭需要键入如下命令::

        CLSE ID<cr><lf>

 回传::

        Command Mode Close<cr><lf>

.. note::
        命令模式进入后60秒无任何命令键入则自动关闭命令模式。如果需要再次管理设备，需要重新进入命令模式。

.. 

 只有在 **工作命令模式进入状态** 中，才可响应如下格式的命令： 

 命令格式::

        COMMAND par1 ... parn<cr><lf>

 其中：

        COMMAND	         为用户给出的命令；	
        par1 ... parn    为命令中可能的参数，以空格隔开。

    具体仪器工作命令有以下4类：初始工作设置命令、仪器参数设置命令、仪器校准命令和仪器复位。


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
仪器数据管理命令
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

""""""""""""""""""""""""""""""""""
串行通信参数设置
""""""""""""""""""""""""""""""""""
 命令格式::

        UART bps,O/E/N,7/8,1/2<cr><lf>

 | bps的值为00300、00600、01200、02400、04800、09600、19200、115200;
 | O/E/N表示奇/偶/无校验;
 | 7/8表示数据位数；
 | 1/2表示停止位数；

 举例::
 
        UART 1200,N,8,1<cr><lf>

 成功送出::

       UART OK<cr><lf>

 不成功送出::

       UART ERROR<cr><lf>

 出厂默认9600bps，无校验，8位数据，1位停止。


""""""""""""""""""""""""""""""""""
地址ID设置
""""""""""""""""""""""""""""""""""
 命令格式::

        ID par<cr><lf>
 
 par 的值为00—99

 成功后送出::    

        ID OK<cr><lf>

 否则送出::

        ID ERROR<cr><lf>

 出厂默认ID=00。

""""""""""""""""""""""""""""""""""
工作模式设置
""""""""""""""""""""""""""""""""""
 命令格式::

        MODE par<cr><lf>

 par ：0—3种工作模式
 成功后送出::

        MODE OK<cr><lf>

 否则送出::

        MODE ERROR<cr><lf>

 0—2模式为自动上传数据模式，0模式输出时间间隔15秒，1、2模式间隔60秒。3模式是被动招测模式，内部数据更新率为60秒。

 出厂默认为0模式。
 
""""""""""""""""""""""""""""""""""
报警阈值设置
""""""""""""""""""""""""""""""""""
 两个报警阈值::

         1. LMT1 par<cr><lf>
         2. LMT2 par<cr><lf>

 LMT1的参数par为报警的下限值，LMT2的参数par为报警的上限值。

 成功后送出::

           LMT OK<cr><lf>

 否则送出::

           LMT ERROR<cr><lf>

.. note::
        要求必须LMT1<LMT2，用户可将这两位设置成最关心的能见度变化点，从而将能见度分为三个警戒段：〉LMT2为正常段，LMT1—LMT2为警戒段1，〈 LMT1为警戒段2。警戒状态值在数据状态数值的第一位显示。
 
""""""""""""""""""""""""""""""""""
主站招测命令
""""""""""""""""""""""""""""""""""
 在工作模式3下，上位机从 |device| 获取能见度数值。

 命令格式::

        DRAW ID<cr><lf>

 成功后送出::

        1分钟内的能见度数值<cr><lf>
 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
数据格式与工作模式
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

 数据格式：

 .. figure:: static\data_format.jpg
        :align: center

""""""""""""""""""""""""""""""""""
工作模式0
""""""""""""""""""""""""""""""""""
 每15秒主动上传数据

""""""""""""""""""""""""""""""""""
工作模式1
""""""""""""""""""""""""""""""""""
 每60秒主动上传数据

""""""""""""""""""""""""""""""""""
工作模式2
""""""""""""""""""""""""""""""""""
 每1分钟主动上传数据，属于厂家出厂前的调试模式，用户不需使用

""""""""""""""""""""""""""""""""""
工作模式3
""""""""""""""""""""""""""""""""""
 接收主站招测命令：``DRAW ID``

 回传格式与工作模式1相同。 属于被动招测模式，内部数据更新率为1分钟。
 

----------------------------------
设备常见问题解决办法
----------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
信息丢失
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 - 你的主台显示软件通讯设置正确吗？

    - 改变波特率，比如改变到1200bps 
    - 检查你的串口参数设置是否正确   
    - 试一下OPEN命令或CLSE命令
    - 试其它的命令


 - 到能见度仪工作现场

    - 带着便携维护计算机（带串口的笔记本电脑）、工具到能见度仪工作现场，制作简易三线通讯线，将信号直接用便携计算机接收，以排除长距离通讯线缆故障

 - 能见度仪是否处于通电状态？

    - 用万用表量一下电源接线端子上有无直流电压供给。电压是否在 9V ~ 24V之间。电源驱动能力是否足够。
    - 线缆是否连接紧密

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
信息存在，但能见度值总为0或满量程
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 - 检查输出状态数值是否为接收器故障报警
 - 到能见度仪工作现场检查接收器板上的电缆接头是否松动
 - 接收器可能损坏，可与厂家联系


.. include:: replace.rst
